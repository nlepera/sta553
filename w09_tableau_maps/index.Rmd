---
title: "Presidential Election Data"
author: "Natalie LePera"
date: "West Chester University <br>STA 503: Data Visualization"
output:
  html_document: 
    toc: yes
    toc_depth: 4
    toc_float: yes
    number_sections: yes
    toc_collapsed: yes
    code_folding: hide
    code_download: yes
    smooth_scroll: true
    theme: readable
---

```{=html}
<style type="text/css">

div#TOC li {
    list-style:none;
    background-color:lightgray;
    background-image:none;
    background-repeat:none;
    background-position:0;
    font-family: Arial, Helvetica, sans-serif;
    color: #780c0c;
}

/* mouse over link */
div#TOC a:hover {
  color: red;
}

/* unvisited link */
div#TOC a:link {
  color: blue;
}



h1.title {
  font-size: 24px;
  color: Darkblue;
  text-align: center;
  font-family: Arial, Helvetica, sans-serif;
  font-variant-caps: normal;
}
h4.subtitle {
  font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: DarkRed;
  text-align: center;
}
h4.author { 
    font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: DarkRed;
  text-align: center;
}
h4.date { 
  font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
  text-align: center;
}
h1 {
    font-size: 24px;
    font-family: "Times New Roman", Times, serif;
    color: darkred;
    text-align: center;
}
h2 {
    font-size: 18px;
    font-family: "Times New Roman", Times, serif;
    color: navy;
    text-align: center;
}

h3 { 
    font-size: 15px;
    font-family: "Times New Roman", Times, serif;
    color: navy;
    text-align: left;
}

h4 { /* Header 4 - and the author and data headers use this too  */
    font-size: 18px;
    font-family: "Times New Roman", Times, serif;
    color: darkred;
    text-align: left;
}
h5 { 
    font-size: 15px;
    font-family: "Times New Roman", Times, serif;
    color: white;
    text-align: left;
}
/* unvisited link */
a:link {
  color: green;
}

/* visited link */
a:visited {
  color: green;
}

/* mouse over link */
a:hover {
  color: red;
}

/* selected link */
a:active {
  color: yellow;
}

</style>
```

```{r setup, include=FALSE}
# code chunk specifies whether the R code, warnings, and output 
# will be included in the output files.
options(repos = list(CRAN="http://cran.rstudio.com/"))
if (!require("tidyverse")) {
   install.packages("tidyverse")
   library(tidyverse)
}
if (!require("knitr")) {
   install.packages("knitr")
   library(knitr)
}
if (!require("sf")) {
   install.packages("sf")
   library(sf)
}
if (!require("cowplot")) {
   install.packages("cowplot")
   library(cowplot)
}
if (!require("latex2exp")) {
   install.packages("latex2exp")
   library(latex2exp)
}
if (!require("plotly")) {
   install.packages("plotly")
   library(plotly)
}
if (!require("gapminder")) {
   install.packages("gapminder")
   library(gapminder)
}
if (!require("png")) {
    install.packages("png")             # Install png package
    library("png")
}
if (!require("RCurl")) {
    install.packages("RCurl")           # Install RCurl package
    library("RCurl")
}
if (!require("colourpicker")) {
    install.packages("colourpicker")              
    library("colourpicker")
}
if (!require("gifski")) {
    install.packages("gifski")              
    library("gifski")
}
if (!require("magick")) {
    install.packages("magick")              
    library("magick")
}
if (!require("grDevices")) {
    install.packages("grDevices")              
    library("grDevices")
}
### ggplot and extensions
if (!require("ggplot2")) {
    install.packages("ggplot2")              
    library("ggplot2")
}
if (!require("gganimate")) {
    install.packages("gganimate")              
    library("gganimate")
}
if (!require("ggridges")) {
    install.packages("ggridges")              
    library("ggridges")
}
if (!require("graphics")) {
    install.packages("graphics")              
    library("graphics")
}
if (!require("openxlsx")) {
    install.packages("openxlsx")              
    library("openxlsx")
}

if (!require("lubridate")) {
    install.packages("lubridate")              
    library("lubridate")
}
if (!require("rjson")) {
    install.packages("rjson")              
    library("rjson")
}
if (!require("leaflet")) {
    install.packages("leaflet")              
    library("leaflet")
}
if (!require("leafpop")) {
    install.packages("leafpop")              
    library("leafpop")
}
if (!require("htmlwidgets")) {
    install.packages("htmlwidgets")              
    library("htmlwidgets")
}
knitr::opts_chunk$set(echo = TRUE,       
                      warning = FALSE,   
                      result = TRUE,   
                      message = FALSE,
                      comment = NA)
```
\

# Prepping the Data Prior to Tableau Map Creation


The County Presidential Election Results 2000 - 2020 dataset was obtained from the <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/VOQCHQMIT">Election Lab Data sets</a>.  This data was read in to r studio as `election.raw` prior to any cleaning.  In order to properly visualize both the county and state level data in Tableau, the `election.raw` data set was duplicated into two subsets: `election.county` and `election.state` respectively.
```{r}
election.raw <- read.csv("https://nlepera.github.io/sta553/w09_tableau_maps/data/PresidentialElection2000To2020.csv")
```

```{r}
election.county.raw <- election.raw
election.state.raw <- election.raw
```

Once separate country and state data sets were created, each data set was transformed to accomplish the following:

  -   Calculate the percentage of each participating party within each county or state
  -   Keep only the winning party in the data set

```{r}
election.county <- mutate(election.county.raw, percent_vote = ((candidatevotes / totalvotes)*100)) %>% 
  group_by(county_fips, year) %>% 
  filter(percent_vote == max(percent_vote, na.rm=TRUE))

election.state <- mutate(election.state.raw, percent_vote = ((candidatevotes / totalvotes)*100)) %>% 
  group_by(state, year) %>% 
  filter(percent_vote == max(percent_vote, na.rm=TRUE))

```

```{r out.height='100%', align='center'}
DT::datatable(election.county, fillContainer = TRUE, options = list(pageLength = 10))
DT::datatable(election.state, fillContainer = TRUE, options = list(pageLength = 10))
```

This parsed data was then exported and uploaded to both <a href="https://github.com/nlepera/sta553/tree/main/w09_tableau_maps/data">Github</a> for retention and Tableau for transformation into a chloropleth map. 

```{r echo=TRUE, eval=FALSE}
write.xlsx(election.county, "C:/Users/natal/OneDrive/Documents/School Files/Spring 2024/STA553 - Data Visualization/sta553/w09_tableau_maps/data/election_county.xlsx", row.names=FALSE )
write.xlsx(election.state, "C:/Users/natal/OneDrive/Documents/School Files/Spring 2024/STA553 - Data Visualization/sta553/w09_tableau_maps/data/election_state.xlsx", row.names=FALSE )
```

Once read into Tableau the Alaska county names were manually decoded utilizing the following <a href="https://www.elections.alaska.gov/doc/forms/H07.pdf">Alaska Election Data District Key</a>

# Interactive Chlorpleth Map

<a href="https://prod-useast-b.online.tableau.com/t/nl10316570740a22d2e/views/PresidentialElectionResultsPerCountyPerYear/Sheet1">Link</a> in case the embed does not cooperate.




<table>
<tr>
<th>
<div class='tableauPlaceholder' id='viz1712200748429' style='position: relative'><noscript><a href='#'><img alt='Presidential Election Results Per County Per Year ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Pr&#47;PresidentialElectionResultsPerCountyPerYear&#47;Sheet1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='PresidentialElectionResultsPerCountyPerYear&#47;Sheet1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Pr&#47;PresidentialElectionResultsPerCountyPerYear&#47;Sheet1&#47;1.png' /> <param name='animate_transition' value='yes' />
<param name='display_static_image' value='yes' />
<param name='display_spinner' value='yes' />
<param name='display_overlay' value='yes' />
<param name='display_count' value='yes' />
<param name='language' value='en-US' />
</object></div>                
<script type='text/javascript'>var divElement = document.getElementById('viz1712200748429');                    
var vizElement = divElement.getElementsByTagName('object')[0];
vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                   
var scriptElement = document.createElement('script');                    
scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                   
vizElement.parentNode.insertBefore(scriptElement, vizElement);                
</script>
</th>
</tr>

<table>
<tr>
<th>
<div class='tableauPlaceholder' id='viz1712200748429' style='position: relative'><noscript><a href='#'><img alt='Presidential Election Results Per County Per Year ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Pr&#47;PresidentialElectionResultsPerCountyPerYear&#47;Sheet1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='PresidentialElectionResultsPerCountyPerYear&#47;Sheet1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Pr&#47;PresidentialElectionResultsPerCountyPerYear&#47;Sheet1&#47;1.png' /> <param name='animate_transition' value='yes' />
<param name='display_static_image' value='yes' />
<param name='display_spinner' value='yes' />
<param name='display_overlay' value='yes' />
<param name='display_count' value='yes' />
<param name='language' value='en-US' />
</object></div>                
<script type='text/javascript'>var divElement = document.getElementById('viz1712200748429');                    
var vizElement = divElement.getElementsByTagName('object')[0];
vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth*0.75)+'px';                   
var scriptElement = document.createElement('script');                    
scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                   
vizElement.parentNode.insertBefore(scriptElement, vizElement);                
</script>
</th>
</tr>
</table>

/