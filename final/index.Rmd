---
title: 'Melbourne Housing Market'
author: '<br>Data obtained from Kaggle (https://www.kaggle.com/datasets/anthonypino/melbourne-housing-market)'
output:
  flexdashboard::flex_dashboard:
      orientation: columns
      verticalLayout: fill
      theme:
        version: 4
        bootswatch: united
runtime: shiny
---
<!-- CSS Style details -->
<style type="text/css">
.navbar{
  position: fixed;
  display: flex;
  justify-content: center;
  width: 100%;
}

.navbar-author{
  font-style: italic;
  font-size: 11px
}

</style>

```{r setup, include = FALSE}
  if (!require("flexdashboard")) {
    install.packages("flexdashboard")
    library(flexdashboard)
  }
if (!require("shiny")) {
  install.packages("shiny")
  library(shiny)
}
if (!require("shinyjs")) {
  install.packages("shinyjs")
  library(shinyjs)
}
if (!require("plotly")) {
  install.packages("plotly")
  library(plotly)
}
if (!require("ggplot2")) {
  install.packages("ggplot2")
  library(ggplot2)
}
if (!require("tidyverse")) {
  install.packages("tidyverse")
  library(tidyverse)
}

```


```{r echo=FALSE}
#read in data set
house_raw <- read.csv("https://nlepera.github.io/sta553/final/data/MelbourneHousing.csv", header = TRUE)
house_raw <- na.omit(house_raw)
house_raw$Car = as.character(house_raw$Car)
regions_houses <- unique(house_raw$Regionname)
regions_houses <- regions_houses[-9]
x_values_select <- names(house_raw[c(3, 5, 9, 12)])
y_values_select <- names(house_raw[c(3, 5, 9, 12)])
```

Column {.sidebar}
-------------------------
<br>
<h4>Instructions:</h4>
<h5>Utilize the following fields to select response and predictor variables</h5>
<br>
```{r}
#input1: Region
radioButtons(inputId = "region",
             label = tags$label("Region", style = "font-variant:small-caps; font-weight:bold"),
             choices = c( as.vector(regions_houses),
                         "All"),
             selected = "All")
```


```{r}
#input2: X Value Selection
selectInput(inputId = "x",
            label = tags$label("Select Variable for X Value on Charts and Plots", style = "font-variant:small-caps; font-weight:bold"),
            choices = x_values_select,
            selected = x_values_select[1])
```

```{r}
#input2: Y Value Selection
selectInput(inputId = "y",
            label = tags$label("Select Variable for Y Value on Charts and Plots", style = "font-variant:small-caps; font-weight:bold"),
            choices = y_values_select,
            selected = y_values_select[2])
```
<br><br>
<p><center><img src="https://nlepera.github.io/sta553/w02_HTML/img/for_sale.png"  
                           width="200"></center></p>

<!-- END of left navigation panel -->

```{r}
#### Sub-setting data based on Region
  workDat = function(){
    if (input$region == "Northern Metropolitan") {
      workingData = house_raw[which(house_raw$Regionname == "Northern Metropolitan"),]
    } else if (input$region == "Western Metropolitan") {
      workingData = house_raw[which(house_raw$Regionname == "Western Metropolitan" ),]
    } else if (input$region == "Southern Metropolitan") { 
      workingData = house_raw[which(house_raw$Regionname == "Southern Metropolitan"),]
    } else if (input$region == "Eastern Metropolitan") {
      workingData = house_raw[which(house_raw$Regionname == "Eastern Metropolitan"),]
    } else if (input$region == "South-Eastern Metropolitan") { 
      workingData = house_raw[which(house_raw$Regionname == "South-Eastern Metropolitan"),]
    } else if (input$region == "Eastern Victoria") {
      workingData = house_raw[which(house_raw$Regionname == "Eastern Victoria"),]
    } else if (input$region == "Northern Victoria") {
      workingData = house_raw[which(house_raw$Regionname == "Northern Victoria"),]
    } else if (input$region == "Western Victoria") {
      workingData = house_raw[which(house_raw$Regionname == "Western Victoria"),]
    } else {
      workingData = house_raw
    }
    workingData 
  }
                                              
```
<br>

<br>

Column {data-width=450  .tabset .tabset-pills} 
-------------------------------------------------------------------
<br>

### **Plot_ly Scatterplot & Regression Table** 
<h3>Plot_ly Scatterplot</h3>
<h6><i><font style = "color:red">Scroll down to view regression table</font></i></h6>
```{r }
renderPlotly({
    plot_ly(data = workDat(),
        x =  ~get(input$x), 
        y =  ~get(input$y), 
        alpha  = 0.9,
        color = ~workDat()$Type,
        type = "scatter",
        mode = "markers",
        hovertemplate = paste(input$x, " = ", workDat()[[input$x]],
                              input$y, " = ", workDat()[[input$y]],
                              'Selected Region', " = ", input$region)) %>% 
    layout(title = (paste(input$x, "vs", input$y)),
           xaxis = list(title = paste(input$x)),
           yaxis = list(title = paste(input$y)))
    
      
  })
```

<h3>Regression Coefficient Table</h3>

```{r}
renderTable({
    br()
    br()
    dataset = workDat()[,-1]
    # define the working data set
    m0 = lm(dataset[,input$y] ~ dataset[,input$x])
    #summary(m0)
    regcoef = data.frame(coef(summary(m0)))
    
    ##
    regcoef$Pvalue = regcoef[,names(regcoef)[4]]
    ###
    regcoef$Variable = c("Intercept", input$X)
    regcoef[,c(6, 1:3, 5)] 
})
```

### **Linear Regression**

```{r }
renderPlot({
  m1 = lm(workDat()[[input$y]]~workDat()[[input$x]])
    plot(workDat()[[input$x]], workDat()[[input$y]],
      main = "",
      type = "p",
      xlab = input$x,
      ylab = input$y,
      alpha = 0.7,
      col = "darkmagenta"
      )
    abline(m1, lwd = 2, col = "red")    

      
  })
```

### **Diagnostics**
```{r}
renderPlot({
    dataset = workDat()   # define the working data set
    m1=lm(dataset[,input$y] ~ dataset[,input$x])
    par(mfrow=c(2,2))
    plot(m1)
  })   


```




Column {data-width=350}
---------------------
<br>
```{r}
renderPlotly({
  plot_ly(data = workDat(),
        x =  ~get(input$x), 
        y =  ~get(input$y),
        type = "box")%>% 
    layout(title = (paste(input$x, "vs", input$y)),
           xaxis = list(title = paste(input$x)),
           yaxis = list(title = paste(input$y)))
})

```


<br>

### **Data Key for Variables** - As provided with dataset

<p><center><img src="https://nlepera.github.io/sta553/final/data/data_key.png"></center></p>

